use std::string;
select {
  "event": event,
  "meta": match $ of
      case %{kv ~= %{present ok}} => patch $ of merge "kv" => {"ok": string::from_utf8_lossy($kv.ok)} end
      case _ => $
    end
} from in where event != "exit" into out;

select event from in where event == "exit" into out/exit;